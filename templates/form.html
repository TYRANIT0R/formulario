{% extends "base.html" %}
{% block content %}
<h1>Compra</h1>
<p class="muted">Precios incluyen IVA (19%).</p>

{% if errors %}
  <div class="error">
    <ul style="margin:0 0 0 18px;padding:0;">
      {% for e in errors %}<li>{{ e }}</li>{% endfor %}
    </ul>
  </div>
{% endif %}

<form method="post" action="/boleta" autocomplete="on" novalidate id="form-compra">
  <label for="product_id">Producto *</label>
  <select id="product_id" name="product_id" required>
    <option value="" disabled {% if not formdata.product_id %}selected{% endif %}>Selecciona un producto</option>
    {% for p in products %}
      <option value="{{ p.id }}" {% if formdata.product_id == p.id %}selected{% endif %}>
        {{ p.name }} — {{ clp(p.price) }}
      </option>
    {% endfor %}
  </select>

  <div class="row">
    <div>
      <label for="quantity">Cantidad *</label>
      <input type="number" id="quantity" name="quantity" min="1" required value="{{ formdata.quantity or 1 }}" />
    </div>
    <div>
      <label>&nbsp;</label>
      <p class="muted">Al emitir verás Neto, IVA y Total.</p>
    </div>
  </div>

  <h3>Datos del cliente</h3>
  <div class="row">
    <div>
      <label for="nombre">Nombre / Razón social *</label>
      <input id="nombre" name="nombre" required minlength="3" maxlength="80"
             pattern="^[A-Za-zÁÉÍÓÚÑáéíóúñ\s.'-]{3,80}$"
             value="{{ formdata.nombre or '' }}" placeholder="Nombre y Apellido o Razón social" />
    </div>
    <div>
      <label for="rut">RUT</label>
      <input id="rut" name="rut" pattern="^\d{1,2}\.?\d{3}\.?\d{3}-[\dkK]$"
             value="{{ formdata.rut or '' }}" placeholder="12.345.678-5" />
    </div>
  </div>

  <div class="row">
    <div>
      <label for="email">Email</label>
      <input id="email" name="email" type="email" value="{{ formdata.email or '' }}" placeholder="correo@dominio.cl" />
    </div>
    <div>
      <label for="direccion">Dirección *</label>
      <input id="direccion" name="direccion" required minlength="5" maxlength="120"
             value="{{ formdata.direccion or '' }}" placeholder="Calle 123, Comuna" />
    </div>
  </div>

  <h3>Documento</h3>
  <div style="display:flex; gap:16px; align-items:center; margin:8px 0 12px;">
    <label><input type="radio" name="tipo_doc" value="boleta" {% if (formdata.tipo_doc or 'boleta') == 'boleta' %}checked{% endif %}> Boleta</label>
    <label><input type="radio" name="tipo_doc" value="factura" {% if formdata.tipo_doc == 'factura' %}checked{% endif %}> Factura</label>
  </div>

  <button class="btn" type="submit">Generar</button>
</form>
{% endblock %}
